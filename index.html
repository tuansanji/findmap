<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find Nearest Buildings</title>
  </head>
  <body>
    <button
      onclick="scrollToTop()"
      id="backToTopBtn"
      style="position: fixed; bottom: 30px; right: 30px"
    >
      back to top
    </button>
    <h1>Find Nearest Buildings</h1>
    <label for="locationInput"
      >Enter Location (Google Maps Link or Coordinates):</label
    >
    <input
      type="text"
      id="locationInput"
      onkeydown="handleInputKeyDown(event)"
      style="width: 500px; height: 100px"
    />
    <button onclick="findNearestBuildings()">Find Nearest Buildings</button>
    <div id="result" style="display: flex; flex-wrap: wrap"></div>

    <script>
      // Function to scroll the page back to the top
      function scrollToTop() {
        const scrollDuration = 500; // Duration of the scroll animation in milliseconds
        const scrollStep = -window.scrollY / (scrollDuration / 15);

        const scrollInterval = setInterval(function () {
          if (window.scrollY !== 0) {
            window.scrollBy(0, scrollStep);
          } else {
            clearInterval(scrollInterval);
          }
        }, 15);
      }

      // Xử lý sự kiện nhấn phím Enter trong ô input
      function handleInputKeyDown(event) {
        if (event.key === "Enter") {
          findNearestBuildings();
        }
      }
      // Hàm tính khoảng cách giữa hai điểm dựa trên tọa độ
      function calculateDistance(coord1, coord2) {
        const [lat1, lon1] = coord1;
        const [lat2, lon2] = coord2;

        const R = 6371; // Bán kính trái đất trong km
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1 * (Math.PI / 180)) *
            Math.cos(lat2 * (Math.PI / 180)) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const distance = R * c;

        return distance;
      }

      // Hàm sắp xếp danh sách tòa nhà theo khoảng cách
      function sortBuildingsByDistance(customerLocation, buildings) {
        const sortedBuildings = buildings.slice(); // Tạo bản sao để không thay đổi mảng gốc
        sortedBuildings.sort((a, b) => {
          const distanceA = calculateDistance(customerLocation, a.location);
          const distanceB = calculateDistance(customerLocation, b.location);
          return distanceA - distanceB;
        });
        return sortedBuildings;
      }

      function findNearestBuildings() {
        const locationInput = document.getElementById("locationInput").value;

        // Xử lý dữ liệu nhập vào (có thể là link Google Maps hoặc tọa độ)
        let customerLocation;
        if (locationInput.includes("google.com/maps")) {
          // Xử lý link Google Maps để trích xuất tọa độ
          // Ví dụ: "https://www.google.com/maps/place/LATITUDE,LONGITUDE"
          const match = locationInput.match(/@([-0-9.]+),([-0-9.]+)/);
          if (match) {
            const latitude = parseFloat(match[1]);
            const longitude = parseFloat(match[2]);
            customerLocation = [latitude, longitude];
          } else {
            alert("Invalid Google Maps link format");
            return;
          }
        } else {
          // Xử lý tọa độ được nhập trực tiếp
          const coords = locationInput.split(",");
          if (coords.length !== 2) {
            alert("Invalid coordinates format");
            return;
          }
          const latitude = parseFloat(coords[0]);
          const longitude = parseFloat(coords[1]);
          customerLocation = [latitude, longitude];
        }

        // Danh sách tòa nhà (thay bằng dữ liệu thật của bạn)
        const buildings = [
          {
            name: " Open 300/600 🇨🇳 Arab Open 500/1000 🇸🇦",
            location: [24.709099, 46.677952],
            image: "../img/1.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.614302, 46.757561],
            image: "../img/2.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.74888, 46.746197],
            image: "../img/3.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.775969, 46.686413],
            image: "../img/4.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.765007, 46.766022],
            image: "../img/5.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.667753, 46.728447],
            image: "../img/6.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.66505, 46.730772],
            image: "../img/7.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.698891, 46.722038],
            image: "../img/8.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.824713, 46.635332],
            image: "../img/9.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.666527, 46.730393],
            image: "../img/10.jpeg",
          },
          {
            name: "Arabic Open 500/1000 🇸🇦",
            location: [24.695709, 46.702053],
            image: "../img/11.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.663883, 46.705864],
            image: "../img/12.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.750193, 46.780224],
            image: "../img/13.jpeg",
          },
          {
            name: "Arabic Open 500/1000 🇸🇦",
            location: [24.807989, 46.625645],
            image: "../img/14.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.780373, 46.766384],
            image: "../img/15.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.877214, 46.619591],
            image: "../img/16.jpeg",
          },
          {
            name: "Arabic Open 500/1000 🇸🇦",
            location: [24.7085381, 46.6777878],
            image: "../img/17.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.669651, 46.722164],
            image: "../img/18.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.726784, 46.60424],
            image: "../img/19.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.748894, 46.746208],
            image: "../img/20.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.802599, 46.795124],
            image: "../img/21.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.637366, 46.57121],
            image: "../img/22.jpeg",
          },
          {
            name: "Open 300/600 No condom 400/1 Ass 500-1🇨🇳",
            location: [24.7991295, 46.6856117],
            image: "../img/61.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳Arabic 500/1000 🇸🇦",
            location: [24.6373653, 46.5686341],
            image: "../img/62.jpeg",
          },
          {
            name: "riyadh map việt 250",
            location: [24.815424, 46.780002],
            image: "../img/22.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.7409096, 46.8348503],
            image: "../img/54.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.5911446, 46.5914993],
            image: "../img/55.jpeg",
          },
          {
            name: "Open 300/600 🇻🇳🇻🇳",
            location: [24.7558804, 46.7999039],
            image: "../img/56.jpeg",
          },
          {
            name: "Open 300/600 🇨🇳",
            location: [24.6685867, 46.7199974],
            image: "../img/67.jpeg",
          },
          {
            name: " Russian Open 500/1000 🇹🇭",
            location: [24.7832661, 46.6595612],
            image: "../img/63.jpeg",
          },
          {
            name: " Arabic Open 500/1000 🇸🇦",
            location: [24.8154755, 46.7821045],
            image: "../img/73.jpeg",
          },
          {
            name: "Russian Open 500/1000 🇹🇭",
            location: [24.8065243, 46.625412],
            image: "../img/74.jpeg",
          },
          //   saudi location
          {
            name: "Abha Open 350/600",
            location: [18.282978, 42.591976],
            image: "../img/23.jpeg",
          },

          {
            name: "  Abha Open 350/600 Ass 600-1",
            location: [18.2419, 42.488125],
            image: "../img/24.jpeg",
          },
          {
            name: "Abha Open 350/600",
            location: [18.194075, 42.564247],
            image: "../img/25.jpeg",
          },
          {
            name: "Abha Open 350/600",
            location: [18.229557, 42.506073],
            image: "../img/78.jpeg",
          },

          {
            name: "Abha Open 350/600",
            location: [18.225231, 42.587166],
            image: "../img/40.jpeg",
          },
          {
            name: "Abha Open 350/600",
            location: [18.229557, 42.506073],
            image: "../img/71.jpeg",
          },
          {
            name: "khobar 26",
            location: [26.289696, 50.186661],
            image: "../img/26.jpeg",
          },

          {
            name: " Khobar 🇨🇳Arab 600/1000 🇸🇦",
            location: [26.2930832, 50.1911163],
            image: "../img/51.jpeg",
          },

          {
            name: "khobar 27",
            location: [26.286106, 50.207184],
            image: "../img/27.jpeg",
          },
          {
            name: "Khobar Open Russian 600/1200🇹🇭",
            location: [26.2800598, 50.1994362],
            image: "../img/72.jpeg",
          },
          {
            name: "khobar 28",
            location: [26.3034, 50.206261],
            image: "../img/28.jpeg",
          },

          {
            name: "khobar 29",
            location: [26.29373, 50.178825],
            image: "../img/29.jpeg",
          },
          {
            name: "khobar 50",
            location: [26.3015137, 50.1956864],
            image: "../img/50.jpeg",
          },
          {
            name: "saudi 30",
            location: [26.295513, 50.176457],
            image: "../img/30.jpeg",
          },
          {
            name: "Jeddah Open 300/600 Old Customer 🇨🇳",
            location: [21.6190109, 39.1621361],
            image: "../img/64.jpeg",
          },
          {
            name: "saudi 31",
            location: [26.272463, 50.215557],
            image: "../img/31.jpeg",
          },
          {
            name: "Jeddah Open Russian 600/1200🇹🇭",
            location: [21.5192451, 39.1594582],
            image: "../img/66.jpeg",
          },

          {
            name: "hoful 32",
            location: [25.352739, 49.581425],
            image: "../img/32.jpeg",
          },
          {
            name: "jeddah 33",
            location: [21.5792046, 39.1554451],
            image: "../img/65.jpeg",
          },
          {
            name: "jeddah 33",
            location: [21.517334, 39.161301],
            image: "../img/33.jpeg",
          },
          {
            name: "jeddah 52",
            location: [21.620813, 39.191269],
            image: "../img/52.jpeg",
          },
          {
            name: "jeddah 34",
            location: [21.617884, 39.189342],
            image: "../img/34.jpeg",
          },
          {
            name: "jeddah 53",
            location: [21.584362, 39.1601028],
            image: "../img/53.jpeg",
          },
          {
            name: "Jeddah Open 2 lady Việt Nam 🇻🇳🇻🇳🇻🇳 300/600",
            location: [21.5172183, 39.1601047],
            image: "../img/68.jpeg",
          },
          {
            name: " Jeddah Open 300/600 🇻🇳🇻🇳🇻🇳 Nhận trẻ OK",
            location: [21.5151329, 39.1577797],
            image: "../img/69.jpeg",
          },
          {
            name: " Jeddah Open 300/600 ",
            location: [21.585001, 39.1858788],
            image: "../img/70.jpeg",
          },
          {
            name: "jeddah 35",
            location: [21.514982, 39.157414],
            image: "../img/35.jpeg",
          },

          {
            name: "jeddah 36",
            location: [21.512943, 39.165569],
            image: "../img/36.jpeg",
          },

          {
            name: "jeddah 37",
            location: [21.568386, 39.177606],
            image: "../img/37.jpeg",
          },

          {
            name: "jeddah 38",
            location: [21.514565, 39.163582],
            image: "../img/38.jpeg",
          },

          {
            name: "jeddah 39",
            location: [21.583387, 39.153301],
            image: "../img/39.jpeg",
          },

          {
            name: "khobar 41",
            location: [26.283901, 50.20348],
            image: "../img/41.jpeg",
          },
          {
            name: "Khobar Open 300/600",
            location: [26.2911587, 50.1824761],
            image: "../img/77.jpeg",
          },
          {
            name: "Khobar Open Arabic 600/1200 Ass 800/1",
            location: [26.2911396, 50.1802445],
            image: "../img/58.jpeg",
          },
          {
            name: "jeddah 42",
            location: [21.516012, 39.159382],
            image: "../img/42.jpeg",
          },
          {
            name: "Jeddah Open 300/600 Ass 600-1🇨🇳Arab 600/1000 Ass 800-1",
            location: [21.5682201, 39.1749878],
            image: "../img/60.jpeg",
          },
          {
            name: "jeddah 42",
            location: [21.5202274, 39.1565972],
            image: "../img/59.jpeg",
          },
          {
            name: "jeddah 43",
            location: [21.593284, 39.155973],
            image: "../img/43.jpeg",
          },

          {
            name: "jeddah 44",
            location: [21.615686, 39.164997],
            image: "../img/44.jpeg",
          },

          {
            name: "jeddah 45",
            location: [21.606899, 39.154701],
            image: "../img/45.jpeg",
          },

          {
            name: "jeddah 46",
            location: [21.525054, 39.178978],
            image: "../img/46.jpeg",
          },
          {
            name: "khobar 47",
            location: [26.2720528, 50.2155113],
            image: "../img/47.jpeg",
          },
          {
            name: "jeddah 48",
            location: [21.488344, 39.226261],
            image: "../img/48.jpeg",
          },
          {
            name: "riyadh 49",
            location: [24.7092247, 46.6703377],
            image: "../img/49.jpeg",
          },
          {
            name: "Jeddah Open 300/600 🇨🇳",
            location: [21.5683861, 39.1750298],
            image: "../img/57.jpeg",
          },
          {
            name: "Jeddah Open Arabic 500/1000 🇸🇦",
            location: [21.5960102, 39.167141],
            image: "../img/75.jpeg",
          },
          {
            name: " Jeddah Open Thailand 🇹🇭300/600",
            location: [21.4952412, 39.21661],
            image: "../img/76.jpeg",
          },
          // Thêm các tòa nhà khác
          {
            name: "Hail City Open 400/700",
            location: [27.4895344, 41.6924134],
            image: "../img/79.jpeg",
          },
          {
            name: "Hail City Open 400/700",
            location: [27.5570107, 41.7209931],
            image: "../img/80.jpeg",
          },
          {
            name: "Tabuk Open 300/600",
            location: [28.3904149, 36.589824],
            image: "../img/81.jpeg",
          },
          {
            name: "Tabuk Open 300/600",
            location: [28.3606148, 36.5576439],
            image: "../img/82.jpeg",
          },
          {
            name: "Tabuk Open 300/600",
            location: [28.3902779, 36.5918961],
            image: "../img/83.jpeg",
          },
        ];

        const sortedBuildings = sortBuildingsByDistance(
          customerLocation,
          buildings
        );

        // Hiển thị kết quả
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "";

        // Giới hạn hiển thị chỉ 15 kết quả
        const maxResults = 30;
        for (let i = 0; i < Math.min(maxResults, sortedBuildings.length); i++) {
          const building = sortedBuildings[i];
          const distance = calculateDistance(
            customerLocation,
            building.location
          );
          resultDiv.innerHTML += `
      <div style="border: 1px solid #333; display: flex; flex-basis: calc(25% - 20px); margin-right: 20px; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-direction: column-reverse;">
        <h3>${building.name}</h3>
        <p>Distance: ${distance.toFixed(2)} km</p>
      
        <img src="${building.image}" alt="${
            building.name
          }" width="200" height="200" />
      </div>
    `;
        }
      }
      // <p>Location: <a target="_blank" href="${locationToGoogleMapsLink(
      //     building.location
      //   )}">View on Google Maps</a></p>
      function locationToGoogleMapsLink(location) {
        return `https://www.google.com/maps/place/${location[0]},${location[1]}`;
      }
    </script>
  </body>
</html>
