<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find Nearest Buildings</title>
  </head>
  <body>
    <h1>Find Nearest Buildings</h1>
    <label for="locationInput"
      >Enter Location (Google Maps Link or Coordinates):</label
    >
    <input type="text" id="locationInput" />
    <button onclick="findNearestBuildings()">Find Nearest Buildings</button>
    <div id="result"></div>

    <script>
      // Hàm tính khoảng cách giữa hai điểm dựa trên tọa độ
      //   function calculateDistance(coord1, coord2) {
      //     // Giống hàm calculateDistance trong ví dụ trước

      //     return distance;
      //   }

      // Hàm tính khoảng cách giữa hai điểm dựa trên tọa độ
      function calculateDistance(coord1, coord2) {
        const [lat1, lon1] = coord1;
        const [lat2, lon2] = coord2;

        const R = 6371; // Bán kính trái đất trong km
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1 * (Math.PI / 180)) *
            Math.cos(lat2 * (Math.PI / 180)) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const distance = R * c;

        return distance;
      }

      // Hàm sắp xếp danh sách tòa nhà theo khoảng cách
      function sortBuildingsByDistance(customerLocation, buildings) {
        const sortedBuildings = buildings.slice(); // Tạo bản sao để không thay đổi mảng gốc
        sortedBuildings.sort((a, b) => {
          const distanceA = calculateDistance(customerLocation, a.location);
          const distanceB = calculateDistance(customerLocation, b.location);
          return distanceA - distanceB;
        });
        return sortedBuildings;
      }

      function findNearestBuildings() {
        const locationInput = document.getElementById("locationInput").value;

        // Xử lý dữ liệu nhập vào (có thể là link Google Maps hoặc tọa độ)
        let customerLocation;
        if (locationInput.includes("google.com/maps")) {
          // Xử lý link Google Maps để trích xuất tọa độ
          // Ví dụ: "https://www.google.com/maps/place/LATITUDE,LONGITUDE"
          const match = locationInput.match(/@([-0-9.]+),([-0-9.]+)/);
          if (match) {
            const latitude = parseFloat(match[1]);
            const longitude = parseFloat(match[2]);
            customerLocation = [latitude, longitude];
          } else {
            alert("Invalid Google Maps link format");
            return;
          }
        } else {
          // Xử lý tọa độ được nhập trực tiếp
          const coords = locationInput.split(",");
          if (coords.length !== 2) {
            alert("Invalid coordinates format");
            return;
          }
          const latitude = parseFloat(coords[0]);
          const longitude = parseFloat(coords[1]);
          customerLocation = [latitude, longitude];
        }

        // Danh sách tòa nhà (thay bằng dữ liệu thật của bạn)
        const buildings = [
          {
            name: "riyadh 1",
            location: [24.709099, 46.677952],
            image: "../img/1.jpeg",
          },
          {
            name: "riyadh 2",
            location: [24.614302, 46.757561],
            image: "../img/2.jpeg",
          },
          {
            name: "riyadh 3",
            location: [24.74888, 46.746197],
            image: "../img/3.jpeg",
          },
          {
            name: "riyadh 4",
            location: [24.775969, 46.686413],
            image: "../img/4.jpeg",
          },
          {
            name: "riyadh 5",
            location: [24.765007, 46.766022],
            image: "../img/5.jpeg",
          },
          {
            name: "riyadh 6",
            location: [24.667753, 46.728447],
            image: "../img/6.jpeg",
          },
          {
            name: "riyadh 7",
            location: [24.66505, 46.730772],
            image: "../img/7.jpeg",
          },
          {
            name: "riyadh 8",
            location: [24.698891, 46.722038],
            image: "../img/8.jpeg",
          },
          {
            name: "riyadh 9",
            location: [24.824713, 46.635332],
            image: "../img/9.jpeg",
          },
          {
            name: "riyadh 10",
            location: [24.666527, 46.730393],
            image: "../img/10.jpeg",
          },
          {
            name: "riyadh 11",
            location: [24.695709, 46.702053],
            image: "../img/11.jpeg",
          },
          {
            name: "riyadh 12",
            location: [24.663883, 46.705864],
            image: "../img/12.jpeg",
          },
          {
            name: "riyadh 13",
            location: [24.750193, 46.780224],
            image: "../img/13.jpeg",
          },
          {
            name: "riyadh 14",
            location: [24.807989, 46.625645],
            image: "../img/14.jpeg",
          },
          // Thêm các tòa nhà khác
        ];
        const sortedBuildings = sortBuildingsByDistance(
          customerLocation,
          buildings
        );

        // Hiển thị kết quả
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<h2>Nearest Buildings:</h2>";
        for (const building of sortedBuildings) {
          const distance = calculateDistance(
            customerLocation,
            building.location
          );
          resultDiv.innerHTML += `
                    <div>
                        <h3>${building.name}</h3>
                        <p>Distance: ${distance.toFixed(2)} km</p>
                        <p>Location: <a href="${locationToGoogleMapsLink(
                          building.location
                        )}">View on Google Maps</a></p>
                        <img src="${building.image}" alt="${
            building.name
          }" width="200">
                    </div>
                `;
        }
      }

      function locationToGoogleMapsLink(location) {
        return `https://www.google.com/maps/place/${location[0]},${location[1]}`;
      }
    </script>
  </body>
</html>
