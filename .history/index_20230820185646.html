<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find Nearest Buildings</title>
  </head>
  <body>
    <h1>Find Nearest Buildings</h1>
    <label for="locationInput"
      >Enter Location (Google Maps Link or Coordinates):</label
    >
    <input type="text" id="locationInput" />
    <button onclick="findNearestBuildings()">Find Nearest Buildings</button>
    <div id="result"></div>

    <script>
      // Hàm tính khoảng cách giữa hai điểm dựa trên tọa độ
      //   function calculateDistance(coord1, coord2) {
      //     // Giống hàm calculateDistance trong ví dụ trước

      //     return distance;
      //   }

      // Hàm tính khoảng cách giữa hai điểm dựa trên tọa độ
      function calculateDistance(coord1, coord2) {
        const [lat1, lon1] = coord1;
        const [lat2, lon2] = coord2;

        const R = 6371; // Bán kính trái đất trong km
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1 * (Math.PI / 180)) *
            Math.cos(lat2 * (Math.PI / 180)) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const distance = R * c;

        return distance;
      }

      // Hàm sắp xếp danh sách tòa nhà theo khoảng cách
      function sortBuildingsByDistance(customerLocation, buildings) {
        const sortedBuildings = buildings.slice(); // Tạo bản sao để không thay đổi mảng gốc
        sortedBuildings.sort((a, b) => {
          const distanceA = calculateDistance(customerLocation, a.location);
          const distanceB = calculateDistance(customerLocation, b.location);
          return distanceA - distanceB;
        });
        return sortedBuildings;
      }

      function findNearestBuildings() {
        const locationInput = document.getElementById("locationInput").value;

        // Xử lý dữ liệu nhập vào (có thể là link Google Maps hoặc tọa độ)
        let customerLocation;
        if (locationInput.includes("google.com/maps")) {
          // Xử lý link Google Maps để trích xuất tọa độ
          // Ví dụ: "https://www.google.com/maps/place/LATITUDE,LONGITUDE"
          const match = locationInput.match(/@([-0-9.]+),([-0-9.]+)/);
          if (match) {
            const latitude = parseFloat(match[1]);
            const longitude = parseFloat(match[2]);
            customerLocation = [latitude, longitude];
          } else {
            alert("Invalid Google Maps link format");
            return;
          }
        } else {
          // Xử lý tọa độ được nhập trực tiếp
          const coords = locationInput.split(",");
          if (coords.length !== 2) {
            alert("Invalid coordinates format");
            return;
          }
          const latitude = parseFloat(coords[0]);
          const longitude = parseFloat(coords[1]);
          customerLocation = [latitude, longitude];
        }

        // Danh sách tòa nhà (thay bằng dữ liệu thật của bạn)
        const buildings = [
          {
            name: "riyadh 1",
            location: [24.709099, 46.677952],
            image: "../img/1.jpeg",
          },
          {
            name: "riyadh 2",
            location: [24.614302, 46.757561],
            image: "../img/2.jpeg",
          },
          {
            name: "riyadh 3",
            location: [24.74888, 46.746197],
            image: "../img/3.jpeg",
          },
          {
            name: "riyadh 4",
            location: [24.775969, 46.686413],
            image: "../img/4.jpeg",
          },
          {
            name: "riyadh 5",
            location: [24.765007, 46.766022],
            image: "../img/5.jpeg",
          },
          {
            name: "riyadh 6",
            location: [24.667753, 46.728447],
            image: "../img/6.jpeg",
          },
          {
            name: "riyadh 7",
            location: [24.66505, 46.730772],
            image: "../img/7.jpeg",
          },
          {
            name: "riyadh 8",
            location: [24.698891, 46.722038],
            image: "../img/8.jpeg",
          },
          {
            name: "riyadh 9",
            location: [24.824713, 46.635332],
            image: "../img/9.jpeg",
          },
          {
            name: "riyadh 10",
            location: [24.666527, 46.730393],
            image: "../img/10.jpeg",
          },
          {
            name: "riyadh 11",
            location: [24.695709, 46.702053],
            image: "../img/11.jpeg",
          },
          {
            name: "riyadh 12",
            location: [24.663883, 46.705864],
            image: "../img/12.jpeg",
          },
          {
            name: "riyadh 13",
            location: [24.750193, 46.780224],
            image: "../img/13.jpeg",
          },
          {
            name: "riyadh 14",
            location: [24.807989, 46.625645],
            image: "../img/14.jpeg",
          },
          {
            name: "riyadh 15",
            location: [24.780373, 46.766384],
            image: "../img/15.jpeg",
          },
          {
            name: "riyadh 16",
            location: [24.877214, 46.619591],
            image: "../img/16.jpeg",
          },
          {
            name: "riyadh 17",
            location: [24.7085381, 46.6777878],
            image: "../img/17.jpeg",
          },
          {
            name: "riyadh 18",
            location: [24.669651, 46.722164],
            image: "../img/18.jpeg",
          },
          {
            name: "riyadh 19",
            location: [24.726784, 46.60424],
            image: "../img/19.jpeg",
          },
          {
            name: "riyadh 20",
            location: [24.748894, 46.746208],
            image: "../img/20.jpeg",
          },
          {
            name: "riyadh 21",
            location: [24.802599, 46.795124],
            image: "../img/21.jpeg",
          },
          {
            name: "riyadh 22",
            location: [24.637366, 46.57121],
            image: "../img/22.jpeg",
          },
          //   saudi location
          {
            name: "abha 23",
            location: [18.282978, 42.591976],
            image: "../img/23.jpeg",
          },

          {
            name: "abha 24",
            location: [18.2419, 42.488125],
            image: "../img/24.jpeg",
          },
          {
            name: "abha 25",
            location: [18.194075, 42.564247],
            image: "../img/25.jpeg",
          },

          {
            name: "khobar 26",
            location: [26.289696, 50.186661],
            image: "../img/26.jpeg",
          },

          {
            name: "khobar 27",
            location: [26.286106, 50.207184],
            image: "../img/27.jpeg",
          },

          {
            name: "khobar 28",
            location: [26.3034, 50.206261],
            image: "../img/28.jpeg",
          },

          {
            name: "khobar 29",
            location: [26.29373, 50.178825],
            image: "../img/29.jpeg",
          },

          {
            name: "saudi 30",
            location: [26.295513, 50.176457],
            image: "../img/30.jpeg",
          },

          {
            name: "saudi 31",
            location: [26.272463, 50.215557],
            image: "../img/31.jpeg",
          },

          {
            name: "hoful 32",
            location: [25.352739, 49.581425],
            image: "../img/32.jpeg",
          },

          {
            name: "jeddah 33",
            location: [21.517334, 39.161301],
            image: "../img/33.jpeg",
          },

          {
            name: "jeddah 34",
            location: [21.617884, 39.189342],
            image: "../img/34.jpeg",
          },

          {
            name: "jeddah 35",
            location: [21.514982, 39.157414],
            image: "../img/35.jpeg",
          },

          {
            name: "jeddah 36",
            location: [21.512943, 39.165569],
            image: "../img/36.jpeg",
          },

          {
            name: "jeddah 37",
            location: [21.568386, 39.177606],
            image: "../img/37.jpeg",
          },

          {
            name: "jeddah 38",
            location: [21.514565, 39.163582],
            image: "../img/38.jpeg",
          },

          {
            name: "jeddah 39",
            location: [21.583387, 39.153301],
            image: "../img/39.jpeg",
          },

          {
            name: "abha 40",
            location: [18.225231, 42.587166],
            image: "../img/40.jpeg",
          },

          {
            name: "khobar 41",
            location: [26.283901, 50.20348],
            image: "../img/41.jpeg",
          },

          {
            name: "jeddah 42",
            location: [21.516012, 39.159382],
            image: "../img/42.jpeg",
          },

          {
            name: "jeddah 43",
            location: [21.593284, 39.155973],
            image: "../img/43.jpeg",
          },

          {
            name: "jeddah 44",
            location: [21.615686, 39.164997],
            image: "../img/44.jpeg",
          },

          {
            name: "jeddah 45",
            location: [21.606899, 39.154701],
            image: "../img/45.jpeg",
          },

          {
            name: "jeddah 46",
            location: [21.525054, 39.178978],
            image: "../img/46.jpeg",
          },

          // Thêm các tòa nhà khác
        ];
        const sortedBuildings = sortBuildingsByDistance(
          customerLocation,
          buildings
        );

        // Hiển thị kết quả
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<h2>Nearest Buildings:</h2>";
        for (const building of sortedBuildings) {
          const distance = calculateDistance(
            customerLocation,
            building.location
          );
          resultDiv.innerHTML += `
            <div
              style="display: flex; align-items: center; justify-content: space-around"
            >
              <h3>${building.name}</h3>
              <p>Distance: ${distance.toFixed(2)} km</p>
              <p>
                Location:
                <a href="${locationToGoogleMapsLink(building.location)}"
                  >View on Google Maps</a
                >
              </p>
              <img src="${building.image}" alt="${
            building.name
          }" width="200" height="300" />
            </div>
          `;
        }
      }

      function locationToGoogleMapsLink(location) {
        return `https://www.google.com/maps/place/${location[0]},${location[1]}`;
      }
    </script>
  </body>
</html>
